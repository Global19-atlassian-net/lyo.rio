<!DOCTYPE html>

<!--
  Copyright (c) 2015 IBM Corporation.

   All rights reserved. This program and the accompanying materials
   are made available under the terms of the Eclipse Public License v1.0
   and Eclipse Distribution License v. 1.0 which accompanies this distribution.

   The Eclipse Public License is available at http://www.eclipse.org/legal/epl-v10.html
   and the Eclipse Distribution License is available at
   http://www.eclipse.org/org/documents/edl-v10.php.

   Contributors:

      Samuel Padgett - initial API and implementation
-->

<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>OSLC 3.0 Reference Implementation</title>
  <link rel="stylesheet" type="text/css" href="style.css">
  <link rel="shortcut icon" href="oslc-16x16.png">
  <script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
</head>

<body>
<img class="logo" src="oslc-192x192.png">
<h1>OSLC 3.0 Reference Implementation</h1>
<p>This is a reference implementation for the

<a href="http://tools.oasis-open.org/version-control/browse/wsvn/oslc-core/specs/oslc-core-v3.html">OSLC 3.0</a>

specifications. Yay! It implements a simple bug tracker using OSLC. To begin
opening sample bugs, click the button below.</p>

<p><button id="openBug">Open Bug</button></p>

<div id="message" class="message"></div>

<p>Bugs are kept in an <a href="http://www.w3.org/TR/ldp/">LDP</a> basic
    container.</p>

<label for="bugs">Bug Container:</label>

<div id="bugs" class="fixed"></div>

<div class="dialog" style="display: none;">
    <div class="dialogTitle">Open Bug</div>
    <div id="dialogContainer"></div>
</div>

<script>
    function showDialog() {
        $('<iframe/>', {
            src: 'newBug.html'
        }).css({
            border: 0,
            width: '475px',
            height: '360px'
        }).appendTo('#dialogContainer');
        $('.dialog').css('display', '');
    }

    window.addEventListener("message", function(event) {
        var sameOrigin =
            location.protocol + '//' + location.hostname  +
            (location.port ? ':'  +location.port : '');
        if (event.origin !== sameOrigin) {
            return;
        }

        // Make sure the message starts with oslc-response:
        var message = event.data;
        if (message.indexOf("oslc-response:") !== 0) {
            return;
        }

        // Handle each result.
        var response = JSON.parse(message.substr("oslc-response:".length));
        var results = response["oslc:results"];
        for (var i = 0; i < results.length; i++) {
            var label = results[i]["oslc:label"];
            var uri = results[i]["rdf:resource"];
            var link = $('<a/>', {
                href: uri
            }).text(label || uri);;
            $('#message').empty().text('New bug: ').append(link);
        }

        loadBugs();

        // Remove the dialog from the page.
        $('#dialogContainer').empty();
        $('.dialog').css('display', 'none');
    }, false);

    function loadBugs() {
        var request = $.ajax('r/bugs', {
            accepts: 'text/turtle',
            headers: {
                Prefer: 'return=representation; include="http://www.w3.org/ns/ldp#PreferContainment"'
            }
        });

        request.done(function(data) {
            $('#bugs').text(data);
        });
    }

    $(document).ready(function() {
        $('#openBug').on('click', function(e) {
            e.preventDefault();
            showDialog();
        });

        loadBugs();
    });
</script>
</body>
</html>
